#!/bin/sh
# postinst script for pycsw

PYCSW_APACHE_CONF=/etc/apache2/conf.d/pycsw
WEB=/var/www
PYCSW_HOME=$WEB/pycsw


cat << EOF > "$PYCSW_APACHE_CONF"

        <Directory $PYCSW_HOME>
	    Options FollowSymLinks +ExecCGI
	    Allow from all
	    AddHandler cgi-script .py
        </Directory>

EOF

if [ ! -e /usr/share/applications/pycsw.desktop ] ; then
   cat << EOF > /usr/share/applications/pycsw.desktop
[Desktop Entry]
Type=Application
Encoding=UTF-8
Name=pycsw
Comment=pycsw catalog server
Categories=Application;Education;Geography;
Exec=firefox http://localhost/pycsw/tester/index.html
Icon=/var/www/pycsw/docs/_static/pycsw-logo.png
Terminal=false
StartupNotify=false
Categories=Education;Geography;
EOF
fi

python $PYCSW_HOME/tester/gen_html.py > $PYCSW_HOME/tester/index.html

/etc/init.d/apache2 force-reload

exit 0
